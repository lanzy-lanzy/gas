{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Customers List</h1>
        <div class="text-sm text-gray-600">
            <span class="font-semibold">{{ pending_count }}</span> Pending • 
            <span class="font-semibold">{{ approved_count }}</span> Approved • 
            <span class="font-semibold">{{ rejected_count }}</span> Rejected
        </div>
    </div>

    <!-- Status Filter Tabs -->
    <div class="mb-6 flex gap-2 border-b border-gray-200 justify-between items-end">
        <div class="flex gap-2">
            <a href="?status=pending" class="px-4 py-2 border-b-2 {% if status_filter == 'pending' %}border-prycegas-orange text-prycegas-orange font-semibold{% else %}border-transparent text-gray-600 hover:text-gray-800{% endif %} transition-colors">
                <i class="fas fa-clock mr-2"></i>Pending ({{ pending_count }})
            </a>
            <a href="?status=approved" class="px-4 py-2 border-b-2 {% if status_filter == 'approved' %}border-green-500 text-green-600 font-semibold{% else %}border-transparent text-gray-600 hover:text-gray-800{% endif %} transition-colors">
                <i class="fas fa-check-circle mr-2"></i>Approved ({{ approved_count }})
            </a>
            <a href="?status=rejected" class="px-4 py-2 border-b-2 {% if status_filter == 'rejected' %}border-red-500 text-red-600 font-semibold{% else %}border-transparent text-gray-600 hover:text-gray-800{% endif %} transition-colors">
                <i class="fas fa-times-circle mr-2"></i>Rejected ({{ rejected_count }})
            </a>
            <a href="?status=all" class="px-4 py-2 border-b-2 {% if status_filter == 'all' %}border-blue-500 text-blue-600 font-semibold{% else %}border-transparent text-gray-600 hover:text-gray-800{% endif %} transition-colors">
                <i class="fas fa-list mr-2"></i>All
            </a>
        </div>
        <!-- Export Buttons -->
        <div class="flex gap-2">
            {% if status_filter == 'pending' or status_filter == 'all' %}
                <a href="{% url 'core:export_registrations_pdf' %}?status=pending" class="px-3 py-2 bg-prycegas-orange text-white rounded hover:bg-prycegas-orange-dark transition-colors text-sm">
                    <i class="fas fa-file-pdf mr-1"></i>Export Pending
                </a>
            {% endif %}
            {% if status_filter == 'approved' or status_filter == 'all' %}
                <a href="{% url 'core:export_registrations_pdf' %}?status=approved" class="px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors text-sm">
                    <i class="fas fa-file-pdf mr-1"></i>Export Approved
                </a>
            {% endif %}
            {% if status_filter == 'rejected' or status_filter == 'all' %}
                <a href="{% url 'core:export_registrations_pdf' %}?status=rejected" class="px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors text-sm">
                    <i class="fas fa-file-pdf mr-1"></i>Export Rejected
                </a>
            {% endif %}
            {% if status_filter == 'all' %}
                <a href="{% url 'core:export_registrations_pdf' %}?status=all" class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors text-sm">
                    <i class="fas fa-file-pdf mr-1"></i>Export All
                </a>
            {% endif %}
        </div>
    </div>

    {% if registrations %}
    <div class="bg-white shadow-md rounded-lg overflow-hidden">
        <table class="min-w-full leading-normal">
            <thead>
                <tr>
                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Username</th>
                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Email</th>
                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Phone</th>
                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">ID Type</th>
                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Submitted</th>
                    <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100"></th>
                </tr>
            </thead>
            <tbody>
                {% for reg in registrations %}
                <tr class="{% cycle 'bg-white' 'bg-gray-50' %}">
                    <td class="px-5 py-5 border-b border-gray-200 text-sm">
                        <p class="text-gray-900 font-medium">{{ reg.username }}</p>
                    </td>
                    <td class="px-5 py-5 border-b border-gray-200 text-sm">
                        <p class="text-gray-700">{{ reg.email }}</p>
                    </td>
                    <td class="px-5 py-5 border-b border-gray-200 text-sm">
                        <p class="text-gray-700">{{ reg.phone_number }}</p>
                    </td>
                    <td class="px-5 py-5 border-b border-gray-200 text-sm">
                        <p class="text-gray-700">{{ reg.get_id_type_display }}</p>
                    </td>
                    <td class="px-5 py-5 border-b border-gray-200 text-sm">
                        {% if reg.status == 'pending' %}
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                <i class="fas fa-clock mr-1"></i>Pending
                            </span>
                        {% elif reg.status == 'approved' %}
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                <i class="fas fa-check-circle mr-1"></i>Approved
                            </span>
                        {% else %}
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                <i class="fas fa-times-circle mr-1"></i>Rejected
                            </span>
                        {% endif %}
                    </td>
                    <td class="px-5 py-5 border-b border-gray-200 text-sm">
                        <p class="text-gray-600">
                            {{ reg.created_at|date:"M d, Y" }}
                            <br>
                            <span class="text-xs text-gray-500">({{ reg.days_pending }} days ago)</span>
                        </p>
                    </td>
                    <td class="px-5 py-5 border-b border-gray-200 text-sm text-right">
                        <a href="{% url 'core:registration_detail' registration_id=reg.id %}" class="text-prycegas-orange hover:text-prycegas-orange-dark font-medium">
                            View Details
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="bg-white shadow-md rounded-lg p-8 text-center">
        <i class="fas fa-inbox text-5xl text-gray-400 mb-4"></i>
        <h3 class="text-lg font-semibold text-gray-700 mb-2">No registrations found</h3>
        <p class="text-gray-600">
            {% if status_filter == 'pending' %}
                No pending registrations awaiting approval.
            {% elif status_filter == 'approved' %}
                No approved registrations.
            {% elif status_filter == 'rejected' %}
                No rejected registrations.
            {% else %}
                No registrations found.
            {% endif %}
        </p>
    </div>
    {% endif %}
</div>
{% endblock %}
